From 591971823079f9f7ea529e837a3194e9c27b1e58 Mon Sep 17 00:00:00 2001
From: Michael Brown <producer@holotronic.dk>
Date: Tue, 25 Oct 2016 17:19:03 +0200
Subject: [PATCH 5/5] Add framebuffer to dtb

Signed-off-by: Michael Brown <producer@holotronic.dk>
---
 arch/arm/dts/socfpga.dtsi                      | 14 ++++++++++++++
 arch/arm/dts/socfpga_cyclone5_de0_nano_soc.dts |  4 ++++
 configs/socfpga_de0_nano_soc_defconfig         |  1 +
 3 files changed, 19 insertions(+)

diff --git a/arch/arm/dts/socfpga.dtsi b/arch/arm/dts/socfpga.dtsi
index 8588221..9cfceb1 100644
--- a/arch/arm/dts/socfpga.dtsi
+++ b/arch/arm/dts/socfpga.dtsi
@@ -499,6 +499,20 @@
 			status = "disabled";
 		};
 
+		alt_vip_vfr_vga: vip@0xff280100 {
+			compatible = "ALTR,vip-frame-reader-14.0", "ALTR,vip-frame-reader-9.1";
+			reg = <0xff280100 0x0080>;
+			clocks = <0 0 &osc1>;
+			clock-names = "clock_reset", "clock_master";
+			max-width = <1366>;	/* MAX_IMAGE_WIDTH type NUMBER */
+			max-height = <768>;	/* MAX_IMAGE_HEIGHT type NUMBER */
+			bits-per-color = <8>;	/* BITS_PER_PIXEL_PER_COLOR_PLANE type NUMBER */
+			colors-per-beat = <4>;	/* NUMBER_OF_CHANNELS_IN_PARALLEL type NUMBER */
+			beats-per-pixel = <1>;	/* NUMBER_OF_CHANNELS_IN_SEQUENCE type NUMBER */
+			mem-word-width = <128>;	/* MEM_PORT_WIDTH type NUMBER */
+			status = "disabled";
+		}; //end vip@0x100000100 (alt_vip_vfr_vga)
+
 		i2c0: i2c@ffc04000 {
 			#address-cells = <1>;
 			#size-cells = <0>;
diff --git a/arch/arm/dts/socfpga_cyclone5_de0_nano_soc.dts b/arch/arm/dts/socfpga_cyclone5_de0_nano_soc.dts
index dc09bed..9edcbc0 100644
--- a/arch/arm/dts/socfpga_cyclone5_de0_nano_soc.dts
+++ b/arch/arm/dts/socfpga_cyclone5_de0_nano_soc.dts
@@ -44,6 +44,10 @@
 	rxc-skew-ps = <1680>;
 };
 
+&alt_vip_vfr_vga {
+	status = "okay";
+};
+
 &gpio0 {
 	status = "okay";
 };
diff --git a/configs/socfpga_de0_nano_soc_defconfig b/configs/socfpga_de0_nano_soc_defconfig
index e27a127..b2e8667 100644
--- a/configs/socfpga_de0_nano_soc_defconfig
+++ b/configs/socfpga_de0_nano_soc_defconfig
@@ -51,3 +51,4 @@ CONFIG_G_DNL_VENDOR_NUM=0x0525
 CONFIG_G_DNL_PRODUCT_NUM=0xa4a5
 CONFIG_USE_TINY_PRINTF=y
 CONFIG_OF_LIBFDT=y
+CONFIG_FB_ADDR=0xff280100
-- 
2.7.4

